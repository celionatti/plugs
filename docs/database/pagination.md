# Database: Pagination

## Introduction

In other frameworks, pagination can be very painful. Plugs makes it a breeze. Plugs's paginator is integrated with the query builder and Eloquent ORM and provides convenient, easy-to-use pagination of database results out of the box.

The generated HTML is compatible with the [Tailwind CSS framework](https://tailwindcss.com/).

## Baisc Usage

### Paginating Query Builder Results

There are several ways to paginate items. The simplest is by using the `paginate` method on the query builder or an Eloquent query. The `paginate` method automatically takes care of setting the proper limit and offset based on the current page being viewed by the user.

By default, the current page is detected by the value of the `page` query string argument on the HTTP request. This value is automatically detected by Plugs, and is also automatically inserted into links generated by the paginator.

```php
namespace App\Controllers;

use App\Models\User;
use Plugs\Http\Request;

class UserController extends Controller
{
    public function index()
    {
        return view('user.index', [
            'users' => User::paginate(15)
        ]);
    }
}
```

### Displaying Pagination Results

When calling the `paginate` method, you will receive an instance of `Plugs\Paginator\Pagination`. When calling the `paginate` method, you should pass the number of results you would like to display "per page" as the first argument.

The `Pagination` object provides access to the result set via its iterator, so you may loop over the results as if they were a standard array:

```php
<div class="container">
    <?php foreach ($users as $user): ?>
        <?php echo $user->name; ?>
    <?php endforeach; ?>
</div>

<?php echo $users->render(); ?>
```

The `render` method will render the links to the rest of the pages in the result set. Each of these links will already contain the proper `page` query string variable. Remember, the HTML generated by the `render` method is compatible with the Tailwind CSS framework.

### Customizing The Paginator URI

The `withPath` method allows you to customize the URI used by the paginator when generating links. For example, if you want the paginator to generate links like `http://example.com/custom/url?page=N`, you should pass `custom/url` to the `withPath` method:

## Including Default Styles

To use the built-in themes (Green, Floating, etc.), you **must** include the pagination CSS in your page (usually in the `<head>` or just before the pagination).

```php
<?= \Plugs\Paginator\Pagination::getStyles() ?>
```

This outputs a `<style>` block containing all the necessary CSS classes for:
- The Default Green Theme
- Floating / Glassmorphism Style
- Animations & Rounding
- Responsive Layouts

## Pagination Styles

Plugs comes with several built-in pagination styles to fit your application's design.

### Standard (Green Theme)
The default `render()` method outputs a full pagination list with a modern "Green" theme that includes numbers, previous/next buttons, and ellipses for large ranges.

```php
<?= $users->render() ?>
```

### Simple Pagination
If you only need "Previous" and "Next" buttons, use `renderSimple()`. This is useful for simpler interfaces where exact page numbers matter less.

```php
<?= $users->renderSimple() ?>
```

### Load More Button
For a "Load More" style experience (popular in mobile apps or infinite scroll-like interfaces), use `renderLoadMore()`.

```php
<?= $users->renderLoadMore() ?>
```

This renders a button if there are more pages. You can also enable AJAX support:

```php
$users->setOptions([
    'ajax_enabled' => true,
    'ajax_container' => '#results-container'
]);
echo $users->renderLoadMore();
```

### Floating Pagination
For a modern, centered, and floating appearance (glassmorphism style), use `renderFloating()`.

```php
<?= $users->renderFloating() ?>
```

## Framework Support

### Bootstrap
The default HTML structure and classes (`page-item`, `page-link`, `pagination`) are fully compatible with **Twitter Bootstrap 4 & 5**. If you have Bootstrap loaded, the pagination will automatically pick up Bootstrap's styling (though you may want to override the `green` theme colors if they conflict).

### Tailwind CSS
To use Tailwind CSS, you can either customize the classes using `setOptions` or, for full control, use a custom view.

**Option 1: Custom View (Recommended)**

Create a view file (e.g., `resources/views/pagination/tailwind.php`) and render it:

```php
<?= $users->links('pagination.tailwind') ?>
```

**Example Tailwind View (`pagination/tailwind.php`):**
```php
<?php if ($paginator->hasPages()): ?>
    <nav role="navigation" aria-label="Pagination" class="flex items-center justify-between">
        <!-- Previous Page Link -->
        <?php if ($paginator->onFirstPage()): ?>
            <span class="px-4 py-2 text-gray-500 bg-white border border-gray-300 cursor-not-allowed rounded-md">Previous</span>
        <?php else: ?>
            <a href="<?= $paginator->previousPageUrl() ?>" class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:text-gray-500 focus:outline-none focus:shadow-outline-blue active:bg-gray-100 transition ease-in-out duration-150">Previous</a>
        <?php endif; ?>

        <!-- Next Page Link -->
        <?php if ($paginator->hasMorePages()): ?>
            <a href="<?= $paginator->nextPageUrl() ?>" class="ml-3 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:text-gray-500 focus:outline-none focus:shadow-outline-blue active:bg-gray-100 transition ease-in-out duration-150">Next</a>
        <?php else: ?>
            <span class="ml-3 px-4 py-2 text-gray-500 bg-white border border-gray-300 cursor-not-allowed rounded-md">Next</span>
        <?php endif; ?>
    </nav>
<?php endif; ?>
```

### Customizing The Paginator URI

```php
$users = User::paginate(15);

$users->withPath('custom/url');
```

### Appending To Pagination Links

You may append to the query string of pagination links using the `appends` method. For example, to append `sort=votes` to each pagination link, you should make the following call to `appends`:

```php
<?php echo $users->appends(['sort' => 'votes'])->render(); ?>
```

If you wish to append all current query string values to the pagination links, you may use the `withQueryString` method:

```php
<?php echo $users->withQueryString()->render(); ?>
```

## Pagination Methods

Each `Pagination` instance provides additional pagination information via the following methods:

- `$results->count()`
- `$results->currentPage()`
- `$results->firstItem()`
- `$results->hasMorePages()`
- `$results->lastItem()`
- `$results->lastPage()` - (Not available when using `simplePaginate`)
- `$results->nextPageUrl()`
- `$results->onFirstPage()`
- `$results->perPage()`
- `$results->previousPageUrl()`
- `$results->total()` - (Not available when using `simplePaginate`)
- `$results->url($page)`

## Repository Pattern

If you are using the Repository pattern, your repositories should return the `Plugs\Paginator\Pagination` object.

```php
use Plugs\Paginator\Pagination;

class UserRepository
{
    public function paginate(int $perPage = 15, ?int $page = null): Pagination
    {
        return User::paginate($perPage, $page);
    }
}
```

## JSON Conversion

The `Pagination` class implements the `JsonSerializable` interface and exposes the `toJson` method, so it's very easy to convert your pagination results to JSON. You may also convert a paginator instance to JSON by returning it from a route or controller action:

```php
use App\Models\User;

### API Pagination Responses

When building APIs, you may use the `paginateResponse()` method to return a standardized JSON structure containing the data, pagination metadata, and links:

```php
use App\Models\User;

return User::paginateResponse(15);
```

For more advanced search scenarios combining filtering and pagination, use `searchResponse()`:

```php
return User::searchResponse($_GET);
```

The response will follow a consistent structure:

```json
{
    "success": true,
    "status": 200,
    "data": [...],
    "meta": {
        "total": 50,
        "per_page": 15,
        "current_page": 1,
        "last_page": 4,
        "from": 1,
        "to": 15,
        "path": "http://example.com/users"
    },
    "links": {
        "first": "http://example.com/users?page=1",
        "last": "http://example.com/users?page=4",
        "prev": null,
        "next": "http://example.com/users?page=2"
    }
}
```

## Collections
